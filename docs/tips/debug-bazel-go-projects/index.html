<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-tips/debug-bazel-go-projects" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.0.0">
<title data-rh="true">Debug Bazel rules_go projects | Meroton</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://meroton.github.io/docs/tips/debug-bazel-go-projects/"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Debug Bazel rules_go projects | Meroton"><meta data-rh="true" name="description" content="Case study: Buildozer"><meta data-rh="true" property="og:description" content="Case study: Buildozer"><link data-rh="true" rel="icon" href="/img/favicon.svg"><link data-rh="true" rel="canonical" href="https://meroton.github.io/docs/tips/debug-bazel-go-projects/"><link data-rh="true" rel="alternate" href="https://meroton.github.io/docs/tips/debug-bazel-go-projects/" hreflang="en"><link data-rh="true" rel="alternate" href="https://meroton.github.io/docs/tips/debug-bazel-go-projects/" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title=" RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title=" Atom Feed">
<link rel="alternate" type="application/json" href="/blog/feed.json" title=" JSON Feed">



<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-LVF8V72WEQ"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-LVF8V72WEQ",{anonymize_ip:!0})</script><link rel="stylesheet" href="/assets/css/styles.08bb7386.css">
<script src="/assets/js/runtime~main.07ef3303.js" defer="defer"></script>
<script src="/assets/js/main.ffef2fb6.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Meroton" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="Meroton" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Meroton</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/intro/">Documentation</a><a class="navbar__item navbar__link" href="/services/">Services</a><a class="navbar__item navbar__link" href="/blog/">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://forms.gle/wchwDu6roWg6A7U29" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Sign up<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro/">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/theory/components-of-a-build/">Theory</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/practice/rebase-and-reformat-git-branches-automatically/">Practice</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/tips/">Tips and Tricks</a><button aria-label="Collapse sidebar category &#x27;Tips and Tricks&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/tips/debug-bazel-go-projects/">Debug Bazel rules_go projects</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/tips/non-deterministic-builds/">Non-deterministic Builds</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/improved-chroot-in-buildbarn/">Improved chroot in Buildbarn</a><button aria-label="Expand sidebar category &#x27;Improved chroot in Buildbarn&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/tips/"><span itemprop="name">Tips and Tricks</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Debug Bazel rules_go projects</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Debug Bazel rules_go projects</h1>
<p>Case study: Buildozer</p>
<p>The other day I needed to improve <a href="https://github.com/bazelbuild/buildtools/blob/master/buildozer/README.md" target="_blank" rel="noopener noreferrer"><code>buildozer</code></a> a little
and naturally wanted to run <code>buildozer</code> in the <a href="https://github.com/go-delve/delve/" target="_blank" rel="noopener noreferrer"><code>dlv</code></a> debugger.
I learn by doing and think through debugging.
Where I would previously use the <a href="/docs/tips/debug-bazel-go-projects/#execroot-trick">execroot trick</a>
to debug programs that operate on absolute paths
it did not work for this.
<code>buildozer</code> operates on the current working directory
so executing it from within Bazel&#x27;s output directory does not work.</p>
<p>Instead I used the <a href="https://github.com/bazelbuild/rules_go/issues/1708#issuecomment-791114337" target="_blank" rel="noopener noreferrer">substitute path technique</a> from <a href="https://github.com/bazelbuild/rules_go/" target="_blank" rel="noopener noreferrer">rules_go</a>,
thanks Danny!
This article is a little show-case
for how you can easily do the same in your terminal
and with configuration your IDE too.
It leverages several cool <code>dlv</code> features.
I will show you how to:</p>
<ul>
<li>Debug <code>buildozer</code></li>
<li>Find all the debug symbols</li>
<li>Manage debug symbols for multiple go projects in different bazel projects.</li>
</ul>
<p>The techniques are general and work for many languages,
only the tooling differs.
You can do the same for <code>gdb</code> and <a href="https://github.com/rr-debugger/rr" target="_blank" rel="noopener noreferrer"><code>rr</code></a> when building C/C++ code.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="substitute-path">Substitute path<a href="#substitute-path" class="hash-link" aria-label="Direct link to Substitute path" title="Direct link to Substitute path">​</a></h2>
<p>Substitute path is a common debugger command to change where to look for debug symbols.
Programs compiled with debug symbols have paths to the source files,
which often works well.
But binaries built by Bazel
need some extra care.
For its <em>sandbox</em> and <em>execroot</em> directory structure
does not look like the source code tree.</p>
<p>One big source of confusion is the <code>external/</code> directory
where all external code is put in a flat hierarchy.
The code could come from any remote repository,
or even be bundled with the source code of the program
at an arbitrary location in the source tree.</p>
<p>For the <a href="https://github.com/bazelbuild/buildtools" target="_blank" rel="noopener noreferrer">buildtools</a> project we use the following substitute paths
with the <code>&lt;BUILDTOOLS&gt;</code> placeholder for the repository path.
<code>/bazel-buildtools</code> is the <a href="https://bazel.build/remote/output-directories#layout" target="_blank" rel="noopener noreferrer">convenience symlink</a> to the <em>execroot</em>,
if you do not build them instead use <code>$(bazel info output_path)/..</code> to find the path.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">(dlv) config substitute-path external/ &lt;BUILDTOOLS&gt;/bazel-buildtools/external</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(dlv) config substitute-path GOROOT/   &lt;BUILDTOOLS&gt;/bazel-buildtools/external/go-sdk</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(dlv) config substitute-path &quot;&quot;        &lt;BUILDTOOLS&gt;/bazel-buildtools/</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="initialize-delve-with-project-specific-settings">Initialize delve with project-specific settings<a href="#initialize-delve-with-project-specific-settings" class="hash-link" aria-label="Direct link to Initialize delve with project-specific settings" title="Direct link to Initialize delve with project-specific settings">​</a></h2>
<p>You <em>could</em> use <code>dlv</code>&#x27;s configuration file to save these.
If you only work with one project that works fine.
<em>The</em> config file is singular for your computer:
<code>$XDG_CONFIG_HOME/dlv/config.yml</code> or <code>~/.dlv/config.yml</code>.
It is a natural location for your debugging preferences,
but not to describe how individual projects work.
The config file is <a href="https://github.com/go-delve/delve/blob/master/Documentation/cli/README.md" target="_blank" rel="noopener noreferrer">documented here</a>.</p>
<p>To set settings for a specific project
use the <code>--init &lt;command file&gt;</code> flag.
You can provide any debugger commands here,
it will initialize the debugging session
as if they were written interactively.</p>
<p>First, compile and store the path information
we need to debug <code>buildozer</code>.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">buildtools $ export BUILDTOOLS=$PWD</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">buildtools $ bazel build -c dbg //buildozer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Target //buildozer:buildozer up-to-date:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  bazel-bin/buildozer/buildozer_/buildozer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">buildtools $ export BUILDOZER=&quot;$(readlink bazel-bin/buildozer/buildozer_/buildozer)&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># We can now run &#x27;buildozer&#x27; in our project.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">buildtools $ cd /path/to/project</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Then, open <code>buildozer</code> in the debugger.
This uses the shell pseudo-file redirection to in-line the commands.
You can also save them to a file for the project.</p>
<div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">Bash</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Fish</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">project $ dlv exec --init &lt;(echo &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    config substitute-path external/ &#x27;&quot;$BUILDTOOLS&quot;&#x27;/bazel-buildtools/external</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    config substitute-path GOROOT/   &#x27;&quot;$BUILDTOOLS&quot;&#x27;/bazel-buildtools/external/go-sdk</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    config substitute-path &quot;&quot;        &#x27;&quot;$BUILDTOOLS&quot;&#x27;/bazel-buildtools/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    print &quot;You can also set break points and automatically start the program.&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    break main.main</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    continue</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27;) &quot;$BUILDOZER&quot; -- -h</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Create and use &#x27;substitute-path.dlv&#x27; for the buildtools project.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">project $ dlv exec --init &quot;$BUILDTOOLS&quot;/substitute-path.dlv &quot;$BUILDOZER&quot; -- -h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Augment it with ad-hoc commands.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">project $ dlv exec --init &lt;( {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cat &quot;$BUILDTOOLS&quot;/substitute-path.dlv</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    echo &#x27;break main.main</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    continue&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">} ) $BUILDOZER -- -h</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">project $ dlv exec --init (echo &#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    config substitute-path external/ &#x27;&quot;$BUILDTOOLS&quot;&#x27;/bazel-buildtools/external</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    config substitute-path GOROOT/   &#x27;&quot;$BUILDTOOLS&quot;&#x27;/bazel-buildtools/external/go-sdk</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    config substitute-path &quot;&quot;        &#x27;&quot;$BUILDTOOLS&quot;&#x27;/bazel-buildtools/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    print &quot;You can also set break points and automatically start the program.&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    break main.main</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    continue</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&#x27; | psub) &quot;$BUILDOZER&quot; -- -h</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Create and use &#x27;substitute-path.dlv&#x27; for the buildtools project.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">project $ dlv exec --init &quot;$BUILDTOOLS&quot;/substitute-path.dlv &quot;$BUILDOZER&quot; -- -h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Augment it with ad-hoc commands.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">project $ dlv exec --init ( begin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    cat &quot;$BUILDTOOLS&quot;/substitute-path.dlv</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    echo &#x27;break main.main</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    continue&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">end | psub ) $BUILDOZER -- -h</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="execroot-trick">Execroot trick<a href="#execroot-trick" class="hash-link" aria-label="Direct link to Execroot trick" title="Direct link to Execroot trick">​</a></h2>
<p>If the execution directory of the program does not matter
you can execute it directly from the <em>execroot</em>,
where all source files are available as they were during compilation in the sandbox.
So the debug symbol paths are correct.
First build, then translate the <code>bazel-bin</code> convenience symlink target
to the real <code>bazel-out</code> path
(<code>bazel-bin</code> is not available in the <em>execroot</em>).</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ bazel build -c dbg //buildozer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Target //buildozer:buildozer up-to-date:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  bazel-bin/buildozer/buildozer_/buildozer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ cd bazel-buildtools</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ dlv exec bazel-out/k8-dbg/bin/buildozer/buildozer_/buildozer -- -h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(dlv) b main.main</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Breakpoint 1 set at 0x6e0a32 for main.main() buildozer/main.go:80</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(dlv) c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> main.main() buildozer/main.go:80 (hits goroutine(1):1 total:1) (PC: 0x6e0a32)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">=&gt;  80: func main() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    81:         flag.Var(&amp;commandsFiles, &quot;f&quot;, &quot;file name(s) to read commands from, use &#x27;-&#x27; for stdin (format:|-separated command line arguments to buildozer, excluding flags)&quot;)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>No settings are needed for <code>dlv</code>.</p>
<p>Finding the <code>bazel-out</code> path is easy with <code>readlink</code>.
This is the permanent output location,
until you change the program or clean away all artifacts.
<code>bazel-bin</code> is just the last build and is frequently rewritten.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">buildtools $ readlink bazel-bin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.../9cc0cee4950d14fcd8254d5df1538d8e/execroot/buildtools/bazel-out/k8-dbg/bin</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>We need <code>bazel-out/k8-dbg/bin</code>.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/meroton/docs/edit/main/docs/tips/debug-bazel-go-projects.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/tips/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Tips and Tricks</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/tips/non-deterministic-builds/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Non-deterministic Builds</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#substitute-path" class="table-of-contents__link toc-highlight">Substitute path</a></li><li><a href="#initialize-delve-with-project-specific-settings" class="table-of-contents__link toc-highlight">Initialize delve with project-specific settings</a></li><li><a href="#execroot-trick" class="table-of-contents__link toc-highlight">Execroot trick</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/intro/">Introduction</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/theory/components-of-a-build/">Theory</a></li></ul></div><div class="col footer__col"><div class="footer__title">About Us</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/services/">Services</a></li><li class="footer__item"><a class="footer__link-item" href="/contact/">Contact</a></li><li class="footer__item"><a href="https://forms.gle/wchwDu6roWg6A7U29" target="_blank" rel="noopener noreferrer" class="footer__link-item">Sign up<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Hosted build system</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/services/self-hosted/">Self hosted</a></li><li class="footer__item"><a class="footer__link-item" href="/services/cloud-environment/">Cloud based</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog/">Blog</a></li><li class="footer__item"><a class="footer__link-item" href="/bug-bounty/">Bug bounty</a></li><li class="footer__item"><a class="footer__link-item" href="/privacy-policy/">Privacy Policy</a></li><li class="footer__item"><a href="https://github.com/meroton" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 Meroton AB</div></div></div></footer></div>
</body>
</html>