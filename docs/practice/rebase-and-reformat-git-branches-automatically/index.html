<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-practice/rebase-and-reformat-git-branches-automatically" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">Automatically reformat all commits on a branch | Meroton</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://meroton.github.io/docs/practice/rebase-and-reformat-git-branches-automatically/"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Automatically reformat all commits on a branch | Meroton"><meta data-rh="true" name="description" content="Preliminaries"><meta data-rh="true" property="og:description" content="Preliminaries"><link data-rh="true" rel="icon" href="/img/favicon.svg"><link data-rh="true" rel="canonical" href="https://meroton.github.io/docs/practice/rebase-and-reformat-git-branches-automatically/"><link data-rh="true" rel="alternate" href="https://meroton.github.io/docs/practice/rebase-and-reformat-git-branches-automatically/" hreflang="en"><link data-rh="true" rel="alternate" href="https://meroton.github.io/docs/practice/rebase-and-reformat-git-branches-automatically/" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Automatically reformat all commits on a branch","item":"https://meroton.github.io/docs/practice/rebase-and-reformat-git-branches-automatically"}]}</script><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title=" RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title=" Atom Feed">
<link rel="alternate" type="application/json" href="/blog/feed.json" title=" JSON Feed">




<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-LVF8V72WEQ"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-LVF8V72WEQ",{anonymize_ip:!0})</script><link rel="stylesheet" href="/assets/css/styles.24067a74.css">
<script src="/assets/js/runtime~main.b4a1946d.js" defer="defer"></script>
<script src="/assets/js/main.ab27fd2f.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Meroton" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="Meroton" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Meroton</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/intro/">Documentation</a><a class="navbar__item navbar__link" href="/services/">Services</a><a class="navbar__item navbar__link" href="/blog/">Blog</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://forms.gle/wchwDu6roWg6A7U29" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Sign up<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro/">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/theory/components-of-a-build/">Theory</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/docs/practice/rebase-and-reformat-git-branches-automatically/">Practice</a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/practice/rebase-and-reformat-git-branches-automatically/">Automatically reformat all commits on a branch</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/tips/">Tips and Tricks</a><button aria-label="Expand sidebar category &#x27;Tips and Tricks&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/improved-chroot-in-buildbarn/">Improved chroot in Buildbarn</a><button aria-label="Expand sidebar category &#x27;Improved chroot in Buildbarn&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Practice</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Automatically reformat all commits on a branch</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Automatically reformat all commits on a branch</h1></header>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="preliminaries">Preliminaries<a href="#preliminaries" class="hash-link" aria-label="Direct link to Preliminaries" title="Direct link to Preliminaries">​</a></h2>
<p>If you have a formatter tool
that can rewrite your code
you can run it automatically on all unmerged commits.
This will show you how to script <code>git-rebase</code>
to do so without any conflicts.</p>
<p>There are two ways to do it manually, forward or backward.
The forward pass amends each commit
and deals with the conflicts when stepping to the next commit.
In contrast the backwards pass, formats each commit from the end,
which will avoid conflicts but for long commit chains it can be almost as boring.</p>
<p>This pattern comes up when working with long-lived feature branches,
or tasks that were almost done, and then pre-empted by other prioritized work.
To make sure that all commits are up to the latest standard
you can run the oneliner(s) from the end of this document.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="unix-philosophy">Unix philosophy<a href="#unix-philosophy" class="hash-link" aria-label="Direct link to Unix philosophy" title="Direct link to Unix philosophy">​</a></h3>
<p>This guide shows a powerful <code>git</code> workflow,
as it is designed with the <em>Unix philosophy</em> much can be automated and scripted.
We use <code>vim</code> as a scriptable editor,
as it is the author&#x27;s daily driver,
but any editor can be used.
An interactive editor is better than simply using <code>awk</code> or <code>sed</code>,
as it allows you to step through the process
and augment it to fit your needs.</p>
<p>If you are a <code>vim</code> user we hope this can brighten your day
and give you another arrow or two to your quiver.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="example-commits">Example commits<a href="#example-commits" class="hash-link" aria-label="Direct link to Example commits" title="Direct link to Example commits">​</a></h3>
<p>Starting off we have three example commits that we will manipulate:</p>
<p>aaa My amazing feature
bbb Other complimentary work
ccc Fix annoying bug</p>
<p>They contain serious work, but the distracted author forgot to run some linters,
or the main branch added more lint requirements after the feature work was started.
We value pristine commits that we can merge,
and all commits should pass all the tests,
to help with bisecting potential errors later.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="first-wave-reformat">First wave: reformat<a href="#first-wave-reformat" class="hash-link" aria-label="Direct link to First wave: reformat" title="Direct link to First wave: reformat">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="reformat-each-commit">Reformat each commit<a href="#reformat-each-commit" class="hash-link" aria-label="Direct link to Reformat each commit" title="Direct link to Reformat each commit">​</a></h3>
<p>We start with a script that we want to run:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#!/bin/sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Formatters and fixers go here.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Replace with your tools of choice! rustfmt, gofmt, black, ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">./run-all-linters-and-autofixers.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Add a new commit with the changes and revert it again.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">git add -u</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">git commit --allow-empty --fixup HEAD</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># &#x27;git-revert&#x27; does not support &#x27;--allow-empty&#x27;.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">git revert --no-commit HEAD</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">git commit --allow-empty --no-edit</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="rebasing">Rebasing<a href="#rebasing" class="hash-link" aria-label="Direct link to Rebasing" title="Direct link to Rebasing">​</a></h3>
<p>The first step is to run the formatting script for every commit:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ git rebase -i --exec=./reformat.sh origin/main</span><br></span></code></pre></div></div>
<p>This opens the interactive rebase todo list with the <code>execute</code> commands filled in:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pick aaa My amazing feature</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">exec ./reformat.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pick bbb Other complimentary work</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">exec ./reformat.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pick ccc Fix annoying bug</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">exec ./reformat.sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Rebase aaa..ccc onto deadbeef (3 commands)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Commands:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># p, pick &lt;commit&gt; = use commit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># r, reword &lt;commit&gt; = use commit, but edit the commit message</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># e, edit &lt;commit&gt; = use commit, but stop for amending</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># s, squash &lt;commit&gt; = use commit, but meld into previous commit</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># f, fixup [-C | -c] &lt;commit&gt; = like &quot;squash&quot; but keep only the previous</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#                    commit&#x27;s log message, unless -C is used, in which case</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#                    keep only this commit&#x27;s message; -c is same as -C but</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#                    opens the editor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># x, exec &lt;command&gt; = run command (the rest of the line) using shell</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>If you made a mistake and want to abort the rebase, without applying any commands exit the editor with a non-zero exit code.
in <code>vim</code> you can do that with <code>:cq</code>.</p><p>To optimize the save-and-quit from <code>:wq&lt;enter&gt;</code> you can instead press <code>ZZ</code> in normal mode.</p></div></div>
<p>This will create two additional commits for each original,
here denoted with helpful commit hash prefixes.
They are grouped together into the final commits that we want to create.</p>
<div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">1: Reformated</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Original</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">aaa My amazing feature</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">aa1 fixup! My amazing feature</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">aa2 Revert &quot;fixup! My amazing feature&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bbb Other complimentary work</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bb1 fixup! Other complimentary work</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bb2 Revert &quot;fixup! Other complimentary work&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ccc Fix annoying bug</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cc1 fixup! Fix annoying bug</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cc2 Revert &quot;fixup! Fix annoying bug&quot;</span><br></span></code></pre></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">aaa My amazing feature</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bbb Other complimentary work</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ccc Fix annoying bug</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div></div></div></div>
<p>The reverts make sure that whatever was broken in each commit is restored,
so the next commit applies cleanly.
<code>aaa</code>, <code>aa1</code> and <code>aa2</code> are the old unit of a commit.
The desired goal is to have the reformatted <code>aaa</code>
and move the unit-boundary after the reformatting fixup.</p>
<p>The desired units are: first <code>aaa</code>, <code>aa1</code>,
then <code>aa2</code>, <code>bbb</code>, <code>bb1</code>
and <code>bb2</code>, <code>ccc</code>, <code>cc1</code> last.</p>
<p>Notice that the final revert <code>cc2</code>
is not needed and must be discard at some point.
We will do it in the second wave,
but you could do it whenever.
(At this point it is possible to just run <code>git checkout HEAD~1</code>.
if you step through this manually it is the most pragmatic solution.)</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="second-wave-fixup">Second wave: fixup<a href="#second-wave-fixup" class="hash-link" aria-label="Direct link to Second wave: fixup" title="Direct link to Second wave: fixup">​</a></h2>
<p>We proceed to the first fixup stage.</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">git rebase -i origin/main</span><br></span></code></pre></div></div>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pick aaa My amazing feature</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pick aa1 fixup! My amazing feature</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pick aa2 Revert &quot;fixup! My amazing feature&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pick bbb Other complimentary work</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pick bb1 fixup! Other complimentary work</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pick bb2 Revert &quot;fixup! Other complimentary work&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pick ccc Fix annoying bug</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pick cc1 fixup! Fix annoying bug</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pick cc2 Revert &quot;fixup! Fix annoying bug&quot;</span><br></span></code></pre></div></div>
<p>Which is modified with the following search-and-replace in <code>vim</code>:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">:g/^\w* \w* \(# \)\?fixup!/s/^pick/fixup/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">^                                 : command</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> ^                                : for all lines</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ^               ^               : that match</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ^^^^^^^^^^^^^^                 : Regexp: &lt;beginning of line&gt;&lt;word&gt; &lt;word&gt;fixup!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                   ^^     ^     ^ : search and replace</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                     ^^^^^        : Regexp: &lt;beginning of line&gt;pick</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                           ^^^^   : replace with &#x27;fixup&#x27;</span><br></span></code></pre></div></div>
<p>Into:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pick aaa My amazing feature</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fixup aa1 fixup! My amazing feature</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pick aa2 Revert &quot;fixup! My amazing feature&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pick bbb Other complimentary work</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fixup bb1 fixup! Other complimentary work</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pick bb2 Revert &quot;fixup! Other complimentary work&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pick ccc Fix annoying bug</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fixup cc1 fixup! Fix annoying bug</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pick cc2 Revert &quot;fixup! Fix annoying bug&quot;</span><br></span></code></pre></div></div>
<p>This gives us:</p>
<div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">2: Fixed-up</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">1: Reformated</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Original</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Aaa My amazing feature</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">aa2 Revert &quot;fixup! My amazing feature&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Bbb Other complimentary work</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bb2 Revert &quot;fixup! Other complimentary work&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Ccc Fix annoying bug</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cc2 Revert &quot;fixup! Fix annoying bug&quot;</span><br></span></code></pre></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">aaa My amazing feature</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">aa1 fixup! My amazing feature</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">aa2 Revert &quot;fixup! My amazing feature&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bbb Other complimentary work</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bb1 fixup! Other complimentary work</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bb2 Revert &quot;fixup! Other complimentary work&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ccc Fix annoying bug</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cc1 fixup! Fix annoying bug</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cc2 Revert &quot;fixup! Fix annoying bug&quot;</span><br></span></code></pre></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">aaa My amazing feature</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bbb Other complimentary work</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ccc Fix annoying bug</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div></div></div></div>
<p><code>aaa</code> and <code>aa1</code> are combined into a single well-formatted commit <code>Aaa</code>,
but the formatting is removed in the following <code>aa2</code>,
so the original <code>bbb</code> still applies (but it is folded into <code>Bbb</code>).</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="why-not---autosquash">Why not <code>--autosquash</code>?<a href="#why-not---autosquash" class="hash-link" aria-label="Direct link to why-not---autosquash" title="Direct link to why-not---autosquash">​</a></h3>
<p>This is a good question, the <code>--autosquash</code> flag has long been a staple for me.
But it does not work if there are duplicated commit messages in the commit chain,
which is a general problem with such messages
not specific to this workflow.</p>
<p>A less-than-imaginative &quot;tidy up&quot; commit message may trip up this flow.
Where all &quot;fixup! tidy up&quot; commits will be applied to the first &quot;tidy up&quot; commit.
To be robust, we do it in vim directly.
It is a simple search and replace,
and serves as the most complete example.
If you do not have duplicated commit messages, you can use <code>--autosquash</code> instead.
Just note that the code to <em>verify</em> that the messages are unique,
is more complex that this workaround.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="third-wave-squash-reverts">Third wave: squash reverts<a href="#third-wave-squash-reverts" class="hash-link" aria-label="Direct link to Third wave: squash reverts" title="Direct link to Third wave: squash reverts">​</a></h2>
<p>Now we want to squash each pair of <code>Revert-fixup</code> and <code>real-commit</code>
into just <code>real-commit</code>.</p>
<p>This is a little tricker than before,
so for good measure we check all the lines we want.
This is shows that you can reuse the last search pattern in the replacement later,
but has not practical value for the automation.</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>If you use <em>neovim</em> you should use <code>:set inccommand=split</code>
which will show the search-and-replacement that would be applied as you type!</p></div></div>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">(vim) /^pick \w* Revert &quot;fixup!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ^                         : search</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       ^                        : Regexp: &lt;beginning of line&gt;pick &lt;word&gt; Revert &quot;fixup!</span><br></span></code></pre></div></div>
<p>This just searches for the revert-fixup commits,
to illustrate that the <code>:g</code> command can use the last search,
this is useful when writing complex regular expressions
and to check that they work.</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">(vim) :g//normal! j0ces</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ^                 : command</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       ^                : for all lines</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ^^              : that match (the last search pattern!)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          ^^^^^^        : execute normal mode commands</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                  ^^    : go down and to the first column</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                    ^^  : change until the end of the word</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                      ^ : to &quot;s&quot;, short for squash.</span><br></span></code></pre></div></div>
<p>Putting it together:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">git rebase -i origin/main</span><br></span></code></pre></div></div>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pick Aaa My amazing feature</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pick aa2 Revert &quot;fixup! My amazing feature&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pick Bbb Other complimentary work</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pick bb2 Revert &quot;fixup! Other complimentary work&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pick Ccc Fix annoying bug</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pick cc2 Revert &quot;fixup! Fix annoying bug&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Rebase Aaa..cc2 onto deadbeef (3 commands)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># ...</span><br></span></code></pre></div></div>
<p>First search-and-replace the pick of revert commits to squashes,
but squash the next line into the revert,
then remove all comment lines
and finally delete the two last lines (a blank line and the final commit).</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">:g/^pick \w* \(# \)\?Revert &quot;fixup!/normal! j0ces</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">:g/^#/d&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Gdk</span><br></span></code></pre></div></div>
<p>This yields the final squashes and <code>cc2</code> is gone:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pick Aaa My amazing feature</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pick aa2 Revert &quot;fixup! My amazing feature&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">squash Bbb Other complimentary work</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pick bb2 Revert &quot;fixup! Other complimentary work&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">squash Ccc Fix annoying bug</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="squash-messages">Squash messages<a href="#squash-messages" class="hash-link" aria-label="Direct link to Squash messages" title="Direct link to Squash messages">​</a></h3>
<p>We have now done the hard part,
the expected commits are formed with each squash.
However the message needs to be edited,
which is a huge time sink if done manually.
A commit message squash looks like this (with line numbers):</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm" style="counter-reset:line-count 0"><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"># This is a combination of 2 commits.</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"># This is the 1st commit message:</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">Revert &quot;fixup! My amazing feature&quot;</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">This reverts commits aa1</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"># This is the commit message #2:</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">Other complimentary work</span></span><br></span></code></pre></div></div>
<p>The mechanical solution is to delete the first 9 lines.</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">(vim) :1,9d</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ^     : command</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       ^^^  : line 1 through 9</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          ^ : delete</span><br></span></code></pre></div></div>
<p>This comes from the <code>ed</code> heritage, and can use the same command in <code>sed</code>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="automate-the-squash-messages">Automate the Squash messages<a href="#automate-the-squash-messages" class="hash-link" aria-label="Direct link to Automate the Squash messages" title="Direct link to Automate the Squash messages">​</a></h3>
<p>Thankfully the venerable Unix tools allow us to automate this.
We do not need a hands-on-keyboard editor,
but <code>sed</code>, or <code>ed</code> if you are frisky,
can do it for us.</p>
<p>We can experiment with a small file:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ seq 9 &gt; test.file</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ echo &quot;10: abc&quot; &gt;&gt; test.file</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ wc -l test.file</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">10 test.file</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ sed &#x27;1,9d&#x27; test.file</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">10: abc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Now remove them from the file itself</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ sed -i &#x27;1,9d&#x27; test.file</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ cat test.file</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">10: abc</span><br></span></code></pre></div></div>
<p>This is the editor that we will use when rebasing.
Git allows us to set <code>$EDITOR</code> to edit the commit messages,
and <code>$GIT_SEQUENCE_EDITOR</code> to manipulate the interactive rebasing commands.
If the sequence editor is not set <code>git</code> will edit the rebase-todo file with <code>$EDITOR</code> as well,
leading to predictable but unwanted results.</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ env                         \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    GIT_SEQUENCE_EDITOR=&quot;vim&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    EDITOR=&quot;sed &#x27;1,9d&#x27;&quot;       \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    git rebase -i origin/main</span><br></span></code></pre></div></div>
<p>Now search again and rewrite the squash commands.
Do not forget to delete the trailing stuff.</p>
<p>To automate the entire wave with the <code>vim</code> commands
is left as an exercise to the reader :).</p>
<p>Finally, smile as you close the editor and watch git&#x27;s messages fly.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="result">Result<a href="#result" class="hash-link" aria-label="Direct link to Result" title="Direct link to Result">​</a></h3>
<div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">3: Fully-squashed</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">2: Fixed-up</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">1: Reformated</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Original</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Aaa My amazing feature</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">BBb Other complimentary work</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CCc Fix annoying bug</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Aaa My amazing feature</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">aa2 Revert &quot;fixup! My amazing feature&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Bbb Other complimentary work</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bb2 Revert &quot;fixup! Other complimentary work&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Ccc Fix annoying bug</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cc2 Revert &quot;fixup! Fix annoying bug&quot;</span><br></span></code></pre></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">aaa My amazing feature</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">aa1 fixup! My amazing feature</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">aa2 Revert &quot;fixup! My amazing feature&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bbb Other complimentary work</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bb1 fixup! Other complimentary work</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bb2 Revert &quot;fixup! Other complimentary work&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ccc Fix annoying bug</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cc1 fixup! Fix annoying bug</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cc2 Revert &quot;fixup! Fix annoying bug&quot;</span><br></span></code></pre></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">aaa My amazing feature</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bbb Other complimentary work</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ccc Fix annoying bug</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="author-date">Author date?<a href="#author-date" class="hash-link" aria-label="Direct link to Author date?" title="Direct link to Author date?">​</a></h3>
<p>We have not developed the <em>incantation</em>, <code>git-rebase</code> command,
to preserve the author date from the original commits.
But it is an interesting problem that we will address next.</p>
<p>In short the rebase-squash in the <em>third wave</em>
will reset the author time, to the time of the revert.
Here a <code>x git commit --amend --time=&lt;time of the original commit in the squash&gt;</code>
or <code>x git commit --amend --reuse-message=&lt;original commit hash&gt;</code>
should do the trick.</p>
<p>Ta Da!</p>
<p>That is it, you now have transformed all the commits in your commit chain.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="oneliners">Oneliners<a href="#oneliners" class="hash-link" aria-label="Direct link to Oneliners" title="Direct link to Oneliners">​</a></h2>
<p>Now that we have done it manually
and understand what happens,
we can automate all the vim steps.</p>
<p>First wave:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ env                          \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    GIT_SEQUENCE_EDITOR=&quot;true&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    git rebase -i origin/main --exec ./reformat.sh</span><br></span></code></pre></div></div>
<p>Second wave:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ env                                                             \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    GIT_SEQUENCE_EDITOR=&quot;vim +&#x27;g/^\w* \w* \(# \)\?fixup!/s/^pick/fixup/&#x27;&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    git rebase -i origin/main</span><br></span></code></pre></div></div>
<p>Third wave:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ env                                                                                               \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    EDITOR=&quot;sed -i &#x27;1,9d&#x27;&quot;                                                                          \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    GIT_SEQUENCE_EDITOR=&quot;vim +&#x27;g/^#/d&#x27; +&#x27;normal! Gdk&#x27; +&#x27;g/^pick \w* \(# \)\?Revert \&quot;fixup!/normal! j0ces&#x27;&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    git rebase -i origin/main</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#                            ^         ^              ^ : multiple commands</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#                              ^^^^^^                   : remove all comments lines</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#                                        ^^^^^^^^^^^    : delete the last two lines</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># TODO: Preserve author time</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="extra-rebase-tips">Extra rebase tips<a href="#extra-rebase-tips" class="hash-link" aria-label="Direct link to Extra rebase tips" title="Direct link to Extra rebase tips">​</a></h2>
<p>From frequent rebasers here are two tips
to help you rebase quickly.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="cache-work-when-running-tests-on-all-commits">Cache work when running tests on all commits<a href="#cache-work-when-running-tests-on-all-commits" class="hash-link" aria-label="Direct link to Cache work when running tests on all commits" title="Direct link to Cache work when running tests on all commits">​</a></h3>
<p>You can use a simple cache when executing tests on all commits.
Which allows you to loop through the commits multiple times,
and only re-run tests if a commit has changed.
This is <em>very</em> fast, but has all the limitations of cache management.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#!/bin/sh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CACHE=./.user/cache/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mkdir -p &quot;$CACHE&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">set -eu</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lookup () {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    key=$1; shift</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    test -f &quot;$CACHE/$key&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cache () {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    key=$1; shift</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    touch &quot;$CACHE/$key&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">key=&quot;$(git rev-parse HEAD)&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">lookup &quot;$key&quot; &amp;&amp; { echo &quot;cached $key&quot;; exit 0; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&quot;$@&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cache &quot;$key&quot;</span><br></span></code></pre></div></div>
<p>You can now execute <code>reformat.sh</code> in the interactive rebase todo-editing window:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">(vim) :g/pick/normal! ox ./cache ./reformat.sh</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="help-im-lost">Help, I&#x27;m lost<a href="#help-im-lost" class="hash-link" aria-label="Direct link to Help, I&#x27;m lost" title="Direct link to Help, I&#x27;m lost">​</a></h3>
<p>You can always drop a branch before rewriting,
to avoid digging through <code>git-reflog</code> to find where you were.
Julia Evans explains this and many other facets of a rebase-based workflow on <a href="https://jvns.ca/blog/2023/11/06/rebasing-what-can-go-wrong-/#undoing-a-rebase-is-hard" target="_blank" rel="noopener noreferrer">her blog</a>,
which is very informative.</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ git branch reformat-$(date)</span><br></span></code></pre></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/meroton/docs/edit/main/docs/practice/rebase-and-reformat-git-branches-automatically.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/theory/components-of-a-build/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Components of a Build</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/tips/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Tips and Tricks</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#preliminaries" class="table-of-contents__link toc-highlight">Preliminaries</a><ul><li><a href="#unix-philosophy" class="table-of-contents__link toc-highlight">Unix philosophy</a></li><li><a href="#example-commits" class="table-of-contents__link toc-highlight">Example commits</a></li></ul></li><li><a href="#first-wave-reformat" class="table-of-contents__link toc-highlight">First wave: reformat</a><ul><li><a href="#reformat-each-commit" class="table-of-contents__link toc-highlight">Reformat each commit</a></li><li><a href="#rebasing" class="table-of-contents__link toc-highlight">Rebasing</a></li></ul></li><li><a href="#second-wave-fixup" class="table-of-contents__link toc-highlight">Second wave: fixup</a><ul><li><a href="#why-not---autosquash" class="table-of-contents__link toc-highlight">Why not <code>--autosquash</code>?</a></li></ul></li><li><a href="#third-wave-squash-reverts" class="table-of-contents__link toc-highlight">Third wave: squash reverts</a><ul><li><a href="#squash-messages" class="table-of-contents__link toc-highlight">Squash messages</a></li><li><a href="#automate-the-squash-messages" class="table-of-contents__link toc-highlight">Automate the Squash messages</a></li><li><a href="#result" class="table-of-contents__link toc-highlight">Result</a></li><li><a href="#author-date" class="table-of-contents__link toc-highlight">Author date?</a></li></ul></li><li><a href="#oneliners" class="table-of-contents__link toc-highlight">Oneliners</a></li><li><a href="#extra-rebase-tips" class="table-of-contents__link toc-highlight">Extra rebase tips</a><ul><li><a href="#cache-work-when-running-tests-on-all-commits" class="table-of-contents__link toc-highlight">Cache work when running tests on all commits</a></li><li><a href="#help-im-lost" class="table-of-contents__link toc-highlight">Help, I&#39;m lost</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/intro/">Introduction</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/theory/components-of-a-build/">Theory</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">About Us</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/services/">Services</a></li><li class="footer__item"><a class="footer__link-item" href="/contact/">Contact</a></li><li class="footer__item"><a href="https://forms.gle/wchwDu6roWg6A7U29" target="_blank" rel="noopener noreferrer" class="footer__link-item">Sign up<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/jobs/">Jobs</a></li><li class="footer__item"><a class="footer__link-item" href="/master-thesis/">Master Thesis</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Buildbarn Environments</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/services/managed-buildbarn/">Managed Buildbarn</a></li><li class="footer__item"><a class="footer__link-item" href="/services/supported-build-environment/">Supported Build Environment</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog/">Blog</a></li><li class="footer__item"><a class="footer__link-item" href="/bug-bounty/">Bug bounty</a></li><li class="footer__item"><a class="footer__link-item" href="/privacy-policy/">Privacy Policy</a></li><li class="footer__item"><a href="https://github.com/meroton" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2026 Meroton AB</div></div></div></footer></div>
</body>
</html>