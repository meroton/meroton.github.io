<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-tags-post-list-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.1">
<title data-rh="true">10 posts tagged with &quot;buildbarn&quot; | Meroton</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://meroton.github.io/blog/tags/buildbarn/"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" property="og:title" content="10 posts tagged with &quot;buildbarn&quot; | Meroton"><meta data-rh="true" name="docusaurus_tag" content="blog_tags_posts"><meta data-rh="true" name="docsearch:docusaurus_tag" content="blog_tags_posts"><link data-rh="true" rel="icon" href="/img/favicon.svg"><link data-rh="true" rel="canonical" href="https://meroton.github.io/blog/tags/buildbarn/"><link data-rh="true" rel="alternate" href="https://meroton.github.io/blog/tags/buildbarn/" hreflang="en"><link data-rh="true" rel="alternate" href="https://meroton.github.io/blog/tags/buildbarn/" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title=" RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title=" Atom Feed">
<link rel="alternate" type="application/json" href="/blog/feed.json" title=" JSON Feed">




<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-LVF8V72WEQ"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-LVF8V72WEQ",{anonymize_ip:!0})</script><link rel="stylesheet" href="/assets/css/styles.24067a74.css">
<script src="/assets/js/runtime~main.5878f6cb.js" defer="defer"></script>
<script src="/assets/js/main.47cb6dce.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Meroton" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="Meroton" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Meroton</b></a><a class="navbar__item navbar__link" href="/docs/intro/">Documentation</a><a class="navbar__item navbar__link" href="/services/">Services</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog/">Blog</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://forms.gle/wchwDu6roWg6A7U29" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Sign up<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">All articles</div><div role="group"><h3 class="yearGroupHeading_rMGB">2025</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/bazel-buildbarn-and-bonanza/">Bazel, Buildbarn and Bonanza</a></li></ul></div><div role="group"><h3 class="yearGroupHeading_rMGB">2024</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/understanding-the-klm/">Understanding the KLM</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/introducing-buildbarn-fundamentals/">Introducing Meroton’s New Course: Buildbarn Fundamentals</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/summer-buildbar-2024/">Summer Buildbar</a></li></ul></div><div role="group"><h3 class="yearGroupHeading_rMGB">2023</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/Automatically-reformat-all-commits-on-a-branch/">Automatically Reformat all Commits on a Branch</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/improved-chroot-in-buildbarn/">Improved Chroot in Buildbarn</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/buildbarn-updates-2023-11/">Updates to Buildbarn as of November 2023</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/memory-adventure/">Memory Adventure</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/bazelcon-2023/">BazelCon 2023</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/buildbarn-block-sizes/">Buildbarn Block Sizes</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/bb-deployments-updates-2023-02/">Updates to Buildbarn deployment repo as of Febuary 2023</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/bazel-6-errors-build-without-the-bytes/">Bazel 6 Errors when using Build without the Bytes</a></li></ul></div><div role="group"><h3 class="yearGroupHeading_rMGB">2022</h3><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/buildbar-at-meroton-office/">BuildBar at the Meroton Office</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/remote-executors-for-free-tier/">Remote Executors for the Free Environment</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/tips-trix-and-nondeterminism/">Tips, Tricks &amp; Non-Deterministic Builds</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/bb-deploy-updates-2022-04/">Updates to Buildbarn deployment repo as of April 2022</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/about/">Purpose of the Articles</a></li></ul></div></nav></aside><main class="col col--7"><header class="margin-bottom--xl"><h1>10 posts tagged with &quot;buildbarn&quot;</h1><a href="/blog/tags/">View All Tags</a></header><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/blog/bazel-buildbarn-and-bonanza/">Bazel, Buildbarn and Bonanza</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2025-03-24T00:00:00.000Z">March 24, 2025</time> · <!-- -->3 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><img class="avatar__photo authorImage_XqGP" src="/img/benjamin-avatar.png" alt="Benjamin Ingberg"><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><span class="authorName_yefp">Benjamin Ingberg</span></div><div class="authorSocials_rSDt"></div></div></div></div></div></header><div class="markdown"><p>In the Buildbarn event at Snowflake this week, Ed Schouten presented the work on
the <a href="https://github.com/buildbarn/bonanza" target="_blank" rel="noopener noreferrer">Bonanza project</a>. Bonanza is a prototype for a drop in replacement Bazel with
improvements to its communication protocols and written as a client that performs
all of its actions remotely, deduplicated and cacheable.</p>
<h1>How is it different from Bazel?</h1>
<p>Bazel is written in an interesting manner. It is designed from the ground up to
represent a stable description of a build that is reproducible from any
developer&#x27;s machine. Any developer can check out the same source code ask Bazel
to analyze it and get the exact commands Bazel would run to perform the
build.</p>
<p>This involves a lot of computation: Resolving bazel modules, downloading
repository rules, executing them, analyzing the <code>.bzl</code> and <code>BUILD.bazel</code> files,
and finally executing the actions themselves.</p>
<p>Bazel internally represents these computation steps as pure functions returning
deterministic values from a stable key, internally represented as <code>SkyFunctions</code>
returning <code>SkyValues</code> from <code>SkyKeys</code>.</p>
<p>A <code>SkyFunction</code> should return the same <code>SkyValue</code> given the same <code>SkyKey</code> which
makes it a good candidate for being computed only once and have the result
cached and fed through to the next step. But peculiarly only the action
execution itself has been offloaded to remote cache and execution.</p>
<p><img decoding="async" loading="lazy" alt="cache all the things" src="/assets/images/all_the_things-49c295edfd8fdfa47bb93be35ebfa40b.webp" width="842" height="998" class="img_ev3q"></p>
<p>This is what Bonanza attempts to resolve. Instead of having all of that state
computed and represented locally, repeated by each developer and discarded
whenever a flag changes, Bonanza is designed from the ground up to offload all
computations, downloads, and analysis to a remote cacheable system. This
essentially reduces the client side to a very light weight program with the
primary purpose of scanning the source code for modifications and uploading any
local changes.</p>
<h1>What&#x27;s the current state?</h1>
<p>The project is still in an early state prototype state. In the presentation Ed
demonstrated how far the prototype has come, and it was very impressive. The
Bonanza client as of today is capable of analyzing the bb-storage codebase.</p>
<p>There is still a lot remaining before it&#x27;s a production ready system but it is
very impressive progress. Bonanza is capable of running the full <code>bzlmod</code>
resolution, fetching all relevant repository rules from upstream, run those
repository rules, and analyzing the resulting codebase, basically performing
everything a Bazel <code>cquery</code> does, all with fully remote and cacheable manner.</p>
<p>For shops which lean heavily on remote caching and execution the remaining
local load is often the bottleneck for your builds, the ability to offload the
remaining pieces to your build cluster may be the next evolution of your build
system.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/blog/tags/buildbarn/">buildbarn</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/blog/tags/bazel/">bazel</a></li></ul></div></footer></article><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/blog/understanding-the-klm/">Understanding the KLM</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2024-11-11T00:00:00.000Z">November 11, 2024</time> · <!-- -->6 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><img class="avatar__photo authorImage_XqGP" src="/img/benjamin-avatar.png" alt="Benjamin Ingberg"><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><span class="authorName_yefp">Benjamin Ingberg</span></div><div class="authorSocials_rSDt"></div></div></div></div></div></header><div class="markdown"><p>When running a remote cache and execution cluster based on Buildbarn the Key
Location Map (KLM) is a term that you will run into and it is important to take
proper care when sizing the KLM and the number of KLM attempts.</p>
<p>If you are just looking for a ballpark number to get you started, set the number
of get attempts to 16 and the number of put attempts to 64 and use the following
table.</p>
<table><thead><tr><th></th><th>CAS</th><th>AC</th></tr></thead><tbody><tr><td>Average Object Size</td><td>125KB</td><td>1KB</td></tr><tr><td>Storage Size</td><td>500TB</td><td>1GB</td></tr><tr><td>KLM Entries</td><td>16 000 000</td><td>4 000 000</td></tr><tr><td>KLM Size</td><td>1056MB</td><td>264MB</td></tr></tbody></table>
<p>These are arbitrarily chosen values which are unlikely to match your actual
workload. I recommend reading the rest of the article to understand your
settings and how to reason about this. You can then use the prometheus metrics
in the end to validate if your settings are a good match for your workload.</p>
<h1>How does the KLM work?</h1>
<p>The KLM is a <a href="https://en.wikipedia.org/wiki/Hash_table" target="_blank" rel="noopener noreferrer">hash table</a> which
describes the position in your storage layer where your desired data is written
and is indexed by hashing the key of your storage data.</p>
<p>Given a limited key space hash functions will have collisions, it is therefore
important that the KLM is significantly larger than required for fitting a key
for every object. To keep the likelihood of a collision low a naive
implementation would require an enourmous hash table but using a technique
called Robin Hood hashing this requirement can be kept down to a small factor
larger than the size of the key set requirement.</p>
<p>For example, in a blobstore which can fit <code>n</code> objects and that has a KLM which
can fit <code>2n</code> entries every hash would have a 50% chance of corresponding to an
already occupied slot. With Robin Hood hashing we can repeat this process
multiple times by incrementing an attempts counter giving us multiple possible
locations for the same object.</p>
<p>When querying for an object we can then search up to the maximum number of
allowed iterations to find our object in one of these slots. When inserting we
perform a similar solution, namely incrementing the number of attempts whenever
we encounter a collision but taking care to insert the younger of the colliding
objects in the colliding slot and pushing the older object forward.</p>
<p>The number of attempts we allow the KLM to look for a free slot is described by
the two parameters <code>key_location_map_maximum_get_attempts</code> and the
<code>key_location_map_maximum_put_attempts</code> described by the
<a href="https://github.com/buildbarn/bb-storage/blob/0941111f29e31905e4081e6262bccf0c123940ed/pkg/proto/configuration/blobstore/blobstore.proto#L429" target="_blank" rel="noopener noreferrer"><code>LocalBlobAccessConfiguration</code></a>.</p>
<h1>So, how big should the KLM be?</h1>
<p>Given a utilization rate <code>r</code> the chance of finding the object within <code>k</code>
iterations is <code>1-r^k</code>, we can therefore either decrease the utilization rate (by
increasing the size of the KLM) or increase the number of attempts.</p>
<p>Due to the random access nature of the KLM the KLM greatly benefits from being
small enough to fit in memory, even if the KLM itself is disk backed. Should the
KLM be too big to fit in memory it will be constantly paged in and out
detrimenting the system performance.</p>
<p>Simularly, there also needs to be a max number of iterations, in the degenerate
case where the storage fits more entries than the klm is capable of inserting is
full the algorithm would never terminate since every single slot would be
occupied.</p>
<p>Having a KLM that is too small for the number of iterations used is bad.</p>
<p>This is somewhat mitigated by the insertion order where the oldest entries get
pushed out first, since they are less likely to be relevant. This gives a
graceful degradation for when your KLM is too small. You should choose a KLM so
that the number of times you reach the maximum number of iterations is
acceptably low.</p>
<h1>How rare should you keep the maximum nuber of iterations?</h1>
<p>It should be rare, but most objects that get discarded due to the KLM being full
will tend to be old and unused. There is however a point where it is no longer
meaningful to have a larger KLM.</p>
<p>Ultimately, any time you read or write to a disk there is a risk of failure.
Popularly this is described as happening due to cosmic radiation but more
realistically it is due random hardware failures from imperfections in the
hardware.</p>
<p>Picking <code>k</code> and <code>r</code> values that gives a risk of dataloss below the Uncorrectable
Bit Error Rate (UBER) of a disk is simply wasteful, should you wish to reduce
the risk below this value you need to look at mirroring data.</p>
<p><a href="https://documents.westerndigital.com/content/dam/doc-library/en_us/assets/public/western-digital/product/internal-drives/wd-gold-ssd/product-brief-wd-gold-enterprise-class-nvme-ssd.pdf" target="_blank" rel="noopener noreferrer">Western
Digital</a>
advertises that their Gold enterprise NVME disks has an UBER rate of 1 in 10^17,
i.e. about once per 10 petabytes of read data so will serve as a decent
standard.</p>
<p>For a random CAS object of 125KB this corresponds to a failure rate of about 1
in 10^11 reads, giving us this neat graph.</p>
<p><img decoding="async" loading="lazy" alt="diagram" src="/assets/images/failure_rate-00397007b81f92d538f10370aeb9eb29.svg" width="605" height="340" class="img_ev3q"></p>
<p>That is, for a KLM using the recommended 16 iterations giving it more than 5
entries per object in the storage is a waste since you are just as likely to
fail to read the object due to disk errors as due to the KLM accidentally
pushing it out.</p>
<p>Similarly for 32 iterations there is no point in having more than 2 entries per
object, and for 8 iterations there is no point in having more than 20 entries
per object.</p>
<p>As for number of put iterations, just keep it at 4x the number of get
iterations. There is no fancy math here, it just needs to be bigger than the
number of get iterations and it is very cheap since you will only put objects a
miniscule fraction of the amount of times you will get objects.</p>
<p>The thought of data randomly getting lost might upset you spiritually, but you
can comfort yourself with that you are far more likely to lose due to AWS
engineer tripping on a cable in the datacenter.</p>
<h1>How do I verify if my KLMs are properly sized?</h1>
<p>Buildbarn exposes the behavior of the hashing strategy in it&#x27;s Prometheus
metrics, they are exposed in the following metrics:</p>
<ul>
<li><code>hashing_key_location_map_get_attempts</code></li>
<li><code>hashing_key_location_map_get_too_many_attempts_total</code></li>
<li><code>hashing_key_location_map_put_iterations</code></li>
<li><code>hashing_key_location_map_put_too_many_iterations_total</code></li>
</ul>
<p>These metrics exposes the required number of get and put attempts respectively
as well as how many times we exceeded the maximum number of iterations, you can
read the ratio between how many iterations were required to figure out how full
the klm is. I.e. if you perform half as many attempts with 2 iterations as with
1 iteration this implies the klm is half full.</p>
<p>There are ready made Grafana dashboards which visualizes these metrics in in
<a href="https://github.com/buildbarn/bb-deployments" target="_blank" rel="noopener noreferrer">bb-deployments</a>.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/blog/tags/buildbarn/">buildbarn</a></li></ul></div></footer></article><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/blog/introducing-buildbarn-fundamentals/">Introducing Meroton’s New Course: Buildbarn Fundamentals</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2024-09-08T00:00:00.000Z">September 8, 2024</time> · <!-- -->2 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><img class="avatar__photo authorImage_XqGP" src="/img/benjamin-avatar.png" alt="Benjamin Ingberg"><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><span class="authorName_yefp">Benjamin Ingberg</span></div><div class="authorSocials_rSDt"></div></div></div></div></div></header><div class="markdown"><p>At Meroton, we’ve long provided managed Buildbarn environments to help
development teams streamline their build processes. Now, we’re excited to take
it a step further with the introduction of our latest offering: Buildbarn
Fundamentals.</p>
<p>This new course is designed to empower your team with the knowledge and
practical skills needed to manage and operate your own Buildbarn environment.
Whether you&#x27;re just getting started with remote build execution or looking to
take control of your infrastructure, this hands-on course will provide you with
the tools to succeed.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="unlock-the-power-of-buildbarn-with-expert-guidance">Unlock the Power of Buildbarn with Expert Guidance<a href="#unlock-the-power-of-buildbarn-with-expert-guidance" class="hash-link" aria-label="Direct link to Unlock the Power of Buildbarn with Expert Guidance" title="Direct link to Unlock the Power of Buildbarn with Expert Guidance">​</a></h2>
<p><strong>Buildbarn Fundamentals</strong> is more than just a training session; it’s an
opportunity to set up a production-ready Buildbarn reference cluster in your own
AWS environment. By participating in the course, your team will not only
understand what makes Buildbarn tick but also walk away with a fully functional
Remote Build Environment (RBE) cluster, which you can continue to use or adapt
to your organization’s needs.</p>
<p>At Meroton, we believe that mastering the management of remote build
environments is crucial for modern development workflows. This course is
designed to be both comprehensive and practical, offering a deep dive into
Buildbarn while equipping your team with the operational knowledge to
effectively maintain and scale your infrastructure.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="what-youll-learn">What You&#x27;ll Learn<a href="#what-youll-learn" class="hash-link" aria-label="Direct link to What You&#x27;ll Learn" title="Direct link to What You&#x27;ll Learn">​</a></h2>
<p>Buildbarn Fundamentals is a hands-on course that teaches participants how to:</p>
<ul>
<li>Set up a fully operational Buildbarn cluster in AWS</li>
<li>Manage and operate Buildbarn clusters independently</li>
<li>Integrate third-party tools to enhance your build environment and understand
the needs of consumers</li>
<li>Optimize caching, remote execution, and troubleshooting with Buildbarn</li>
</ul>
<p>By the end of the course, your team will have the skills and confidence to
self-manage a Buildbarn environment, enabling you to scale and optimize your
development processes independently.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="more-information">More Information<a href="#more-information" class="hash-link" aria-label="Direct link to More Information" title="Direct link to More Information">​</a></h2>
<p>If you&#x27;re ready to empower your team with the skills to manage your own
Buildbarn infrastructure, get in touch! Contact us at <a href="mailto:sales@meroton.com" target="_blank" rel="noopener noreferrer">sales@meroton.com</a> to learn
more and secure your spot. Or read more at <a href="/services/buildbarn-fundamentals/">Buildbarn Fundamentals</a></p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/blog/tags/buildbarn/">buildbarn</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/blog/tags/meroton/">meroton</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/blog/tags/course/">course</a></li></ul></div></footer></article><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/blog/improved-chroot-in-buildbarn/">Improved Chroot in Buildbarn</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-12-01T00:00:00.000Z">December 1, 2023</time> · <!-- -->One min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><img class="avatar__photo authorImage_XqGP" src="/img/nils-avatar.jpg" alt="Nils Wireklint"><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><span class="authorName_yefp">Nils Wireklint</span></div><div class="authorSocials_rSDt"></div></div></div></div></div></header><div class="markdown"><p>We have just started a documentation series
describing the Buildbarn <code>chroot</code> runners,
and how they can be used for hermetic input roots
that contain all the required tools.
This includes implementation notes for a &quot;mountat&quot; functionality
created through the new Linux mount API,
how you can use this under-documented API
and its shortcomings.
And how this <em>can/will be</em> integrated into Buildbarn,
with technical descriptions of the workers and runners.</p>
<p>The first sections are already available, with more to come!</p>
<p>Sections:</p>
<ul>
<li><a href="/docs/improved-chroot-in-buildbarn/chroot-in-buildbarn/">Use chroot in Buildbarn</a></li>
<li><a href="/docs/improved-chroot-in-buildbarn/implementing-mountat/">Implement mountat with the new mount API</a></li>
<li><a href="/docs/improved-chroot-in-buildbarn/implementing-unmountat/">Unmount from relative file paths and directory file descriptors</a></li>
</ul>
<p>Reference code repository:</p>
<ul>
<li><a href="https://github.com/meroton/prototype-mountat/" target="_blank" rel="noopener noreferrer">https://github.com/meroton/prototype-mountat/</a></li>
</ul></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/blog/tags/linux/">linux</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/blog/tags/syscalls/">syscalls</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/blog/tags/buildbarn/">buildbarn</a></li></ul></div></footer></article><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/blog/buildbarn-updates-2023-11/">Updates to Buildbarn as of November 2023</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-11-21T00:00:00.000Z">November 21, 2023</time> · <!-- -->2 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><img class="avatar__photo authorImage_XqGP" src="/img/benjamin-avatar.png" alt="Benjamin Ingberg"><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><span class="authorName_yefp">Benjamin Ingberg</span></div><div class="authorSocials_rSDt"></div></div></div></div></div></header><div class="markdown"><p>This is a continuation of the
<a href="/blog/bb-deployments-updates-2023-02/">previous update article</a>
and is a high level summary of what has happened in Buildbarn from 2023-02-16 to 2023-11-14.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="added-support-for-jwts-signed-with-rsa">Added support for JWTs signed with RSA<a href="#added-support-for-jwts-signed-with-rsa" class="hash-link" aria-label="Direct link to Added support for JWTs signed with RSA" title="Direct link to Added support for JWTs signed with RSA">​</a></h2>
<p>Support for JWTs signed with RSA has been added.
The following JWT signing algorithms are now supported:</p>
<ul>
<li>HS256</li>
<li>HS384</li>
<li>HS512</li>
<li>RS256</li>
<li>RS384</li>
<li>RS512</li>
<li>EdDSA</li>
<li>ES256</li>
<li>ES384</li>
<li>ES512</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="generalized-tuneables-for-linux-bdi-options">Generalized tuneables for Linux BDI options<a href="#generalized-tuneables-for-linux-bdi-options" class="hash-link" aria-label="Direct link to Generalized tuneables for Linux BDI options" title="Direct link to Generalized tuneables for Linux BDI options">​</a></h2>
<p>Linux 6.2 added a sysfs attribute for toggling <code>BDI_CAP_STRICTLIMIT</code> on FUSE mounts.
If using the FUSE backed virtual file system on Linux 6.2
adding <code>{ &quot;strict_limit&quot;: &quot;0&quot; }</code> to <code>linux_backing_dev_info_tunables</code>
will remove the <code>BDI_CAP_STRICTLIMIT</code> flag from the FUSE mount.</p>
<p>This may improve fileystem performance
especially when running build actions which
uses mmap&#x27;ed files extensively.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="add-support-for-injecting-xcode-environment-variables">Add support for injecting Xcode environment variables<a href="#add-support-for-injecting-xcode-environment-variables" class="hash-link" aria-label="Direct link to Add support for injecting Xcode environment variables" title="Direct link to Add support for injecting Xcode environment variables">​</a></h2>
<p>Remote build with macOS may call into locally installed copies of Xcode.
The path to the local copy of Xcode may vary
and Bazel assumes that the remote execution service
is capable of processing Xcode specific environment variables.</p>
<p>See the <a href="https://github.com/buildbarn/bb-remote-execution/blob/master/pkg/proto/configuration/bb_runner/bb_runner.proto#L133" target="_blank" rel="noopener noreferrer">proto files</a> for details.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="add-a-minimum-timestamp-to-actionresultexpiringblobaccess">Add a minimum timestamp to ActionResultExpiringBlobAccess<a href="#add-a-minimum-timestamp-to-actionresultexpiringblobaccess" class="hash-link" aria-label="Direct link to Add a minimum timestamp to ActionResultExpiringBlobAccess" title="Direct link to Add a minimum timestamp to ActionResultExpiringBlobAccess">​</a></h2>
<p>A misbehaving worker may polluted the action cache,
after fixing the misbehaving worker
we would rather not throw away the entire action cache.</p>
<p>A minimum timestamp in ActionResultExpiringBlobAccess
allows us to mark a timestamp in the past
before which the action should be considered invalid.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="add-authentication-to-http-servers">Add authentication to HTTP servers<a href="#add-authentication-to-http-servers" class="hash-link" aria-label="Direct link to Add authentication to HTTP servers" title="Direct link to Add authentication to HTTP servers">​</a></h2>
<p>Much like the gRPC servers are capable of authenticated configuration
the http servers can now also require authentication.</p>
<p>This allows the bb_browser and bb_scheduler UI
to authenticate access using OAuth2 without involving any other middleware.</p>
<p>This also allows us to add authorization configuration for administrative tasks
such as draining workers or killing of jobs.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="authentication-using-a-json-web-key-set">Authentication using a JSON Web Key Set<a href="#authentication-using-a-json-web-key-set" class="hash-link" aria-label="Direct link to Authentication using a JSON Web Key Set" title="Direct link to Authentication using a JSON Web Key Set">​</a></h2>
<p>JSON Web Key Sets (JWKS) is a standard format
which allows us to specify multiple different encryption keys
that may have been used to sign our JWT authentication.</p>
<p>Buildbarn can load the JWKS specification,
either inline or as a file,
when specifying trusted encryption keys.</p>
<p>This allows us to have rotation with overlap of encryption keys.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/blog/tags/release/">release</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/blog/tags/buildbarn/">buildbarn</a></li></ul></div></footer></article><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/blog/memory-adventure/">Memory Adventure</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-11-13T00:00:00.000Z">November 13, 2023</time> · <!-- -->8 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><img class="avatar__photo authorImage_XqGP" src="/img/nils-avatar.jpg" alt="Nils Wireklint"><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><span class="authorName_yefp">Nils Wireklint</span></div><div class="authorSocials_rSDt"></div></div></div></div></div></header><div class="markdown"><p>An adventure in finding a memory thief in Starlark-land</p>
<p>This is a summary and follow-up to <a href="https://www.youtube.com/watch?v=IXimf4DCAoY#t=7h21m57s" target="_blank" rel="noopener noreferrer">my talk</a> at BazelCon-2023.
With abridged code examples, the full instructions are available <a href="https://github.com/meroton/memory-adventure" target="_blank" rel="noopener noreferrer">together with the code</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="problem-statement">Problem Statement<a href="#problem-statement" class="hash-link" aria-label="Direct link to Problem Statement" title="Direct link to Problem Statement">​</a></h2>
<p>First, we lament Bazel&#x27;s out-of-memory errors,
and point out that the often useful Starlark stacktrace does not always show up.
Some allocation errors just crash Bazel without giving and indication of which allocation failed.</p>
<p><img decoding="async" loading="lazy" alt="allocation" src="/assets/images/memory-allocation-failure-298bf3c0d8e472754fd513fa6c0ce57d.png" width="1358" height="952" class="img_ev3q"></p>
<p>This diagram illustrates a common problem for memory errors,
the allocation that fails may not be the problem,
it is just the straw that breaks the camel&#x27;s back.
And the real thief may already have allocated its memory.</p>
<p>We have seen many errors when working with clients,
and they typically hide in big corporate code bases.
Which complicates troubleshooting, discussion and error reporting.
So we create a synthetic repository to try to illustrate the problem,
and have something to discuss.
The code and instructions are available <a href="https://github.com/meroton/memory-adventure" target="_blank" rel="noopener noreferrer">here</a>.</p>
<p>Errors and poor performance in the analysis phase
are not good at all.
This is because the analysis must always be done
before starting to build all actions.
With big projects the number of configuration to build for can be very large,
so one cannot rely on CI runners to build the same configuration over and over,
to retain the analysis cache.
Instead it is on the critical-path for all builds,
especially if the actions themselves are cached remotely.</p>
<p>To illustrate (some of the problem) we have a reproduction repository
with example code base with some Python and C programs.
To introduce memory problems, and make it a little more complex
we add two rules: one CPU intensive rule (&quot;spinlock&quot;)
and one memory intensive aspect (&quot;traverse&quot;).
The &quot;traverse&quot; aspect encodes the full dependency tree of all targets
and writes that to a file with <code>ctx.actions.write</code>.
So the allocations are tied to the Action object.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="toolbox">Toolbox<a href="#toolbox" class="hash-link" aria-label="Direct link to Toolbox" title="Direct link to Toolbox">​</a></h2>
<p>We have a couple of tools available, many are discussed in the <a href="https://bazel.build/rules/performance#memory-profiling" target="_blank" rel="noopener noreferrer">memory optimization guide</a>,
but we find that some problems can slip through the cracks.</p>
<p>First off, there are the post-build analysis tools in bazel:</p>
<ul>
<li><code>bazel info</code></li>
<li><code>bazel dump --rules</code></li>
<li><code>bazel aquery --skyframe_state</code></li>
</ul>
<p>These are a good starting point and have served us well on many occasions.
But with this project they seem to miss some allocations
We will return to that later.
Additionally, these tool will not give any information if the Bazel server crashes.
You will need to increase the memory and run the same build again.</p>
<p>Then one can use Java tools to inspect what the JVM is doing:</p>
<ul>
<li><a href="https://eclipse.dev/mat/documentation/" target="_blank" rel="noopener noreferrer">Eclipse Memory Analyzer</a></li>
<li><code>jmap</code></li>
</ul>
<p>The best approach here is to ask Bazel to save the heap if it crashes,
so it can be analyzed post-mortem: <code>bazel --heap_dump_on_oom</code></p>
<p>And lastly, use Bazel&#x27;s profiling information:</p>
<ul>
<li><code>bazel --profile=profile.gz --generate_json_trace_profile --noslim_profile</code></li>
</ul>
<p>This contains structured information
and is written continuously to disk,
so if Bazel crashes we can still parse it,
we just need to discard partially truncated events.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="expected-memory-consumption">Expected Memory consumption<a href="#expected-memory-consumption" class="hash-link" aria-label="Direct link to Expected Memory consumption" title="Direct link to Expected Memory consumption">​</a></h2>
<p>As the two rules write their string allocations to output files
we get a clear picture of the expected RAM usage (or at least a lower bound).</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ bazel clean</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ bazel build \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --aspects @example//memory:eat.bzl%traverse \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --output_groups=default,eat_memory \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  //...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Memory intensive tree traversal (in KB)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ find bazel-out/ -name &#x27;*.tree&#x27; | xargs du | cut -f1 | paste -sd &#x27;+&#x27; | bc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">78504</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># CPU intensive spinlocks (in KB)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ find bazel-out/ -name &#x27;*.spinlock&#x27; | xargs du | cut -f1 | paste -sd &#x27;+&#x27; | bc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">3400</span><br></span></code></pre></div></div>
<p>Here is a table with the data:</p>
<table><thead><tr><th></th><th>Memory for each target</th><th>Total</th></tr></thead><tbody><tr><td>Memory intensive</td><td>0-17 MB</td><td>79 MB</td></tr><tr><td>CPU intensive</td><td>136 KB</td><td>3.4 MB</td></tr></tbody></table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="reported-memory-consumption">Reported Memory Consumption<a href="#reported-memory-consumption" class="hash-link" aria-label="Direct link to Reported Memory Consumption" title="Direct link to Reported Memory Consumption">​</a></h2>
<p>Next, we check with the diagnostic tools.</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ bazel version</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Bazelisk version: development</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Build label: 6.4.0</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="bazel-dump---rules">Bazel dump --rules<a href="#bazel-dump---rules" class="hash-link" aria-label="Direct link to Bazel dump --rules" title="Direct link to Bazel dump --rules">​</a></h3>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ bazel $STARTUP_FLAGS --host_jvm_args=-Xmx&quot;10g&quot; dump --rules</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Warning: this information is intended for consumption by developers</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">only, and may change at any time. Script against it at your own risk!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RULE                              COUNT     ACTIONS          BYTES         EACH</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cc_library                            4          17        524,320      131,080</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">native_binary                         1           4        524,288      524,288</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cc_binary                             6          54        262,176       43,696</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">toolchain_type                       14           0              0            0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">toolchain                            74           0              0            0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ASPECT                             COUNT     ACTIONS          BYTES         EACH</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">traverse                              85          81        262,432        3,087</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spinlock14                            35          66        524,112       14,974</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">spinlock15                            35          66              0            0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span></code></pre></div></div>
<p>First, there are some common rules that we do not care about here,
then we have the Aspects.
<code>traverse</code> is the memory intensive aspect,
which is applied on the command line
and <code>spinlock&lt;N&gt;</code> are the CPU intensive rules,
with identical implementations just numbered (there are 25 of them).</p>
<p>It is a little surprising that only one have allocations.
And the action count for each aspect does not make sense either,
as this is not a transitive aspect.
It just runs a single action each time the rule is instantiated.
The hypothesis is that this is a display problem,
with code shared between rules.
There are 25 rules, with 25 distinct implementation functions,
but they in turn call the same function with the action.
So the &quot;count&quot; and &quot;actions&quot; columns are glued together,
but the &quot;bytes&quot; is reported for just one of the rules (it would be bad if this was double-counted).</p>
<p>Either way,
the total number of bytes does not add up to what we expect.
Compare the output to the lower-bound determined before:</p>
<p>|  | Memory for each target | Total | Reported Total |
| ---- | ---- | ----------- |
| Memory intensive | 0-17 MB | 79 MB | 262 kB
| CPU intensive | 136 KB |  3.4 MB | 524 kB</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="skylark-memory-profile">Skylark Memory Profile<a href="#skylark-memory-profile" class="hash-link" aria-label="Direct link to Skylark Memory Profile" title="Direct link to Skylark Memory Profile">​</a></h3>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>This is not part of the video.</p></div></div>
<p>The skylark memory profiler is much more advanced,
and can be dumped after a successful build.</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ bazel $STARTUP_FLAGS --host_jvm_args=-Xmx&quot;$mem&quot; dump \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    --skylark_memory=&quot;$dir/memory.pprof&quot;</span><br></span></code></pre></div></div>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ pprof manual/2023-10-30/10g-2/memory.pprof</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Main binary filename not available.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Type: memory</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Time: Oct 30, 2023 at 12:16pm (CET)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Entering interactive mode (type &quot;help&quot; for commands, &quot;o&quot; for options)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">(pprof) top</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Showing nodes accounting for 2816.70kB, 73.34% of 3840.68kB total</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Showing top 10 nodes out of 19</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      flat  flat%   sum%        cum   cum%</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     512kB 13.33% 13.33%      512kB 13.33%  impl2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  256.16kB  6.67% 20.00%   256.16kB  6.67%  traverse_impl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  256.11kB  6.67% 26.67%   256.11kB  6.67%  _add_linker_artifacts_output_groups</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  256.09kB  6.67% 33.34%   256.09kB  6.67%  alias</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  256.09kB  6.67% 40.00%   256.09kB  6.67%  rule</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  256.08kB  6.67% 46.67%   256.08kB  6.67%  to_list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  256.06kB  6.67% 53.34%   256.06kB  6.67%  impl7</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  256.04kB  6.67% 60.01%   256.04kB  6.67%  _is_stamping_enabled</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  256.04kB  6.67% 66.67%   256.04kB  6.67%  impl18</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  256.03kB  6.67% 73.34%   768.15kB 20.00%  cc_binary_impl</span><br></span></code></pre></div></div>
<p>Here the Memory intensive aspect shows up with 256kB,
which is inline with the output from <code>bazel dump --rules</code>,
but not reflecting the big allocations we know it makes.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="eclipse-memory-analyzer">Eclipse Memory Analyzer<a href="#eclipse-memory-analyzer" class="hash-link" aria-label="Direct link to Eclipse Memory Analyzer" title="Direct link to Eclipse Memory Analyzer">​</a></h3>
<p>The final tool we have investigated is the Java heap analysis tool
<a href="https://eclipse.dev/mat/documentation/" target="_blank" rel="noopener noreferrer">Eclipse Memory Analyzer</a>,
which can easily be used with Bazel&#x27;s <code>--heap_dump_on_oom</code> flag.
On the other hand it is a little tricker to find a heap dump from a successful build.</p>
<p><img decoding="async" loading="lazy" alt="eclipse-analysis" src="/assets/images/eclipse-memory-analyzer-5f46da77b0ac91a7a92dc4c2d3b445b3.png" width="1082" height="402" class="img_ev3q"></p>
<p>Here we see the (very) big allocation clear as day,
but have no information of its provenance.</p>
<p>We have not found how to track this back to a Skylark function, Skyframe evaluator
or anything that could be cross-referenced with the profiling information.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="build-time">Build Time<a href="#build-time" class="hash-link" aria-label="Direct link to Build Time" title="Direct link to Build Time">​</a></h2>
<p>The next section of the talk shows the execution time of the build
with varying memory limits.</p>
<p><img decoding="async" loading="lazy" alt="combined" src="/assets/images/build-time-memory-plot-39f61e675034b7e845f9abdbfa8951f4.png" width="640" height="480" class="img_ev3q"></p>
<p>This is benchmarked with 5 data points for each memory limit,
and the plot shows failure if there was at least one crash among the data points.
There is a region where the build starts to succeed more and more often, but sometimes crashes.
So the Crash and not-crash graphs overlap a little,
you want to have some leeway to avoid flaky builds from occasional out-of-memory crashes.</p>
<p>We see that the Skymeld graph requires a lot less memory than a regular build,
that is because our big allocations are all tied to Action objects.
Enabling Skymeld lets Bazel start executing Actions as soon as they are ready,
so the resident set of Action objects does not grow so large,
and the allocations can be freed much sooner.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="pessimization-with-limited-memory">Pessimization with limited memory<a href="#pessimization-with-limited-memory" class="hash-link" aria-label="Direct link to Pessimization with limited memory" title="Direct link to Pessimization with limited memory">​</a></h2>
<p><img decoding="async" loading="lazy" alt="pessimization" src="/assets/images/low-memory-pessimization-667ab96247ad01ee0ec7d5b75b830d84.png" width="1212" height="827" class="img_ev3q"></p>
<p>We saw a hump in the build time for the Skymeld graph,
where the builds did succeed in the 300 - 400 MB range,
but the build speed gradually increased, reaching a plateau at around 500 MB.
This is a pattern we have seen before,
where more RAM, or more efficient rules can improve build performance.</p>
<p>This is probably because the memory pressure and the Java Garbage Collector
interferes with the Skyframe work.
See <a href="https://www.youtube.com/watch?v=8Dc8R_Zrf6M&amp;t=3039s" target="_blank" rel="noopener noreferrer">Benjamin Peterson&#x27;s great talk</a> about the Skyframe for more information.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="future-work">Future work<a href="#future-work" class="hash-link" aria-label="Direct link to Future work" title="Direct link to Future work">​</a></h2>
<p><img decoding="async" loading="lazy" alt="example profile" src="/assets/images/example-chrome-tracing-424c445f4f5a56244ed23a270ba7c0c3.png" width="809" height="664" class="img_ev3q"></p>
<p>This section details future work for more tools and signals
that we can find from Bazel&#x27;s profile information
<code>--profile=profile.gz --generate_json_trace_profile --noslim_profile</code>.
Written in the standard <code>chrome://tracing</code> format
it is easy to parse for both successful and failed builds.</p>
<p>This contains events for the garbage collector,
and all executed Starlark functions.</p>
<p>These can be correlated
to find which functions are active during, or before, garbage collection events.
Additionally, one could collect this information for all failed builds,
and see if some functions are overrepresented
among the last active functions for each evaluator in the build.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/blog/tags/bazel/">bazel</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/blog/tags/buildbarn/">buildbarn</a></li></ul></div></footer></article><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/blog/bazelcon-2023/">BazelCon 2023</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-11-02T00:00:00.000Z">November 2, 2023</time> · <!-- -->2 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><img class="avatar__photo authorImage_XqGP" src="/img/fredrik-avatar.png" alt="Fredrik Medley"><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><span class="authorName_yefp">Fredrik Medley</span></div><div class="authorSocials_rSDt"></div></div></div></div></div></header><div class="markdown"><p>Meroton visited BazelCon 2023 in Munich October 24-25, 2023.
During the conference, we held three talks:</p>
<ul>
<li><a href="https://www.youtube.com/watch?v=8Dc8R_Zrf6M#t=7h36m20s" target="_blank" rel="noopener noreferrer">Remote Output Service - How not to have your bytes and eat them too</a>
by Benjamin Ingberg about bb_clientd and the Remote Output Service.</li>
<li><a href="https://www.youtube.com/watch?v=IXimf4DCAoY#t=3h2m10s" target="_blank" rel="noopener noreferrer">Buildbarn - From 100 to 100.000 CPUs</a>
(<a href="https://docs.google.com/presentation/d/14qgMa1J9hBMTU017PlpQokKtS5n0KxJbJXPjndxqPqE/edit?usp=sharing&amp;resourcekey=0-OF3Hrwvr5G7aDnJG_ABRhw" target="_blank" rel="noopener noreferrer">slides</a>)
by Fredrik Medley.</li>
<li><a href="https://www.youtube.com/watch?v=IXimf4DCAoY#t=7h21m57s" target="_blank" rel="noopener noreferrer">Dude, where is my RAM? - An adventure in finding a RAM thief in Starlak land</a>
by Nils Wireklint about difficulties in debugging out-of-memory errors in Bazel.</li>
</ul>
<p>Other talks that mentioned Buildbarn were:</p>
<ul>
<li><a href="https://www.youtube.com/watch?v=8Dc8R_Zrf6M#t=5h41m5s" target="_blank" rel="noopener noreferrer">Migrating a Multiple-Platform Game Engine to Bazel</a>
where Kai Zhang from NetEase talks about a
<a href="https://github.com/kkpattern/bb-remote-execution-py" target="_blank" rel="noopener noreferrer">Buildbarn worker implementation in Python for Windows and MacOS</a>.</li>
<li><a href="https://www.youtube.com/watch?v=8Dc8R_Zrf6M#t=7h56m2s" target="_blank" rel="noopener noreferrer">Planting Bazel in barren soil: A Perl Story</a>
where Manuel Naranjo from Booking.com is using Buildbarn for remote execution and Buildbuddy for Build Event Streaming.</li>
</ul>
<p>We are thankful for all amazing chats with the community and are looking forward to BazelCon 2024.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/blog/tags/bazel/">bazel</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/blog/tags/buildbarn/">buildbarn</a></li></ul></div></footer></article><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/blog/buildbarn-block-sizes/">Buildbarn Block Sizes</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-04-11T00:00:00.000Z">April 11, 2023</time> · <!-- -->3 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><img class="avatar__photo authorImage_XqGP" src="/img/benjamin-avatar.png" alt="Benjamin Ingberg"><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><span class="authorName_yefp">Benjamin Ingberg</span></div><div class="authorSocials_rSDt"></div></div></div></div></div></header><div class="markdown"><p>When starting out with remote caching,
an error you are likely to run into is:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">java.io.IOException: com.google.devtools.build.lib.remote.ExecutionStatusException:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">INVALID_ARGUMENT: Failed to store previous blob 1-&lt;HASH&gt;-&lt;LARGE_NUM&gt;:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Shard 1: Blob is &lt;LARGE_NUM&gt; bytes in size,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">while this backend is only capable of storing blobs of up to 238608384 bytes in size</span><br></span></code></pre></div></div>
<p>This is because your storage backend is too small.
You are attempting to upload a blob larger than the largest blob accepted by your storage backend.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="how-do-i-fix-it">How do I fix it?<a href="#how-do-i-fix-it" class="hash-link" aria-label="Direct link to How do I fix it?" title="Direct link to How do I fix it?">​</a></h2>
<p>The largest blob you can store is the size of your your storage device
divided by the number of blocks in your device.</p>
<p>To store larger blobs,
either increase the size of your storage device
or decrease the number of blocks it is split into.
Larger storage devices will take more disk,
while fewer blocks will decrease the granularity which your cache works with.</p>
<p>In
<a href="https://github.com/buildbarn/bb-deployments" target="_blank" rel="noopener noreferrer">bb-deployments</a>
this setting is found in
<a href="https://github.com/buildbarn/bb-deployments/blob/d63c032b2b4d96f93cb889f95add15c26118d771/docker-compose/config/storage.jsonnet" target="_blank" rel="noopener noreferrer">storage.jsonnet</a>.</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">contentAddressableStorage</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">backend</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string-property property" style="color:#36acaa">&#x27;local&#x27;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token literal-property property" style="color:#36acaa">oldBlocks</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token literal-property property" style="color:#36acaa">currentBlocks</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">24</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token literal-property property" style="color:#36acaa">newBlocks</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token literal-property property" style="color:#36acaa">blocksOnBlockDevice</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token literal-property property" style="color:#36acaa">source</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token literal-property property" style="color:#36acaa">file</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token literal-property property" style="color:#36acaa">path</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;/storage-cas/blocks&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token literal-property property" style="color:#36acaa">sizeBytes</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">8</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1024</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1024</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1024</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 8GiB</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token literal-property property" style="color:#36acaa">spareBlocks</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">// ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>To facilitate getting started bb-deployments emulates a block device by using an 8GiB large file.
This file is small enough to fit most builds while not taking over the disk completely from a developers machine.</p>
<p>The device is then split into 36 blocks (8+24+1+3),
where each block can then store a maximum of 238608384 bytes (8GiB / 36 - some alignment).</p>
<p>In production it is preferable to use a large raw block device for this purpose.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="what-does-newoldcurrentspare-mean">What does new/old/current/spare mean?<a href="#what-does-newoldcurrentspare-mean" class="hash-link" aria-label="Direct link to What does new/old/current/spare mean?" title="Direct link to What does new/old/current/spare mean?">​</a></h2>
<p>In depth documentation about all the settings are available in the
<a href="https://github.com/buildbarn/bb-storage/blob/master/pkg/proto/configuration/blobstore/blobstore.proto" target="_blank" rel="noopener noreferrer">configuration proto files</a>.</p>
<p>In essence the storage works as a ringbuffer where the assignment of each block is rotated.
Consider a 5 block configuration with 1 old, 2 current, 1 new and 1 spare block.</p>
<p><img decoding="async" loading="lazy" alt="diagram" src="/assets/images/2023-04-11-buildbarn-block-size-1-15e36bcc18a3d4fcef69de02f8941f0e.svg" width="1190" height="559" class="img_ev3q"></p>
<p>As data is referenced from an old block
it gets written into a new block.
When the new block is full the role rotates.</p>
<p><img decoding="async" loading="lazy" alt="diagram" src="/assets/images/2023-04-11-buildbarn-block-size-2-6e29080d339215d72c87cdd8a8a0000b.svg" width="1190" height="559" class="img_ev3q"></p>
<p>There are some tradeoffs in behaviour to consider when choosing your block layout. Fewer blocks will allow larger individual blobs at the cost of granularity. Here is a quick summary of the meaning of the different fields.</p>
<ul>
<li><strong>Old</strong> - Region where reads are actively copied over to new, too small value and your device behaves more like a FIFO than a LRU cache, too large and your device does a lot of uneccesary copying.</li>
<li><strong>Current</strong> - Stable region, should be the majority of your device.</li>
<li><strong>New</strong> - Region for writing new data to, must be 1 for AC and should be 1-4 for CAS. Having a couple of new blocks allows data to be better spread out over the device so as to not expire at the same time.</li>
<li><strong>Spare</strong> - Region for giving ongoing reads some time to finish before data starts getting overwritten.</li>
</ul></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/blog/tags/buildbarn/">buildbarn</a></li></ul></div></footer></article><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/blog/bb-deployments-updates-2023-02/">Updates to Buildbarn deployment repo as of Febuary 2023</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2023-02-21T00:00:00.000Z">February 21, 2023</time> · <!-- -->4 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><img class="avatar__photo authorImage_XqGP" src="/img/benjamin-avatar.png" alt="Benjamin Ingberg"><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><span class="authorName_yefp">Benjamin Ingberg</span></div><div class="authorSocials_rSDt"></div></div></div></div></div></header><div class="markdown"><p>The example configuration project for buildbarn
<a href="https://github.com/buildbarn/bb-deployments" target="_blank" rel="noopener noreferrer">bb-deployments</a>
has gotten updates.</p>
<p>This is a continuation of the
<a href="/blog/bb-deploy-updates-2022-04/">updates from last year article</a>
and is a high level summary of what has happened since April 2022 up to 2023-02-16.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="let-referenceexpandingblobaccess-support-gcs">Let ReferenceExpandingBlobAccess support GCS<a href="#let-referenceexpandingblobaccess-support-gcs" class="hash-link" aria-label="Direct link to Let ReferenceExpandingBlobAccess support GCS" title="Direct link to Let ReferenceExpandingBlobAccess support GCS">​</a></h2>
<p>ReferenceExpandingBlobAccess already supports S3 so support was extended to Google Cloud Storage buckets.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="support-for-prefetching-virtual-filesystems">Support for prefetching Virtual Filesystems<a href="#support-for-prefetching-virtual-filesystems" class="hash-link" aria-label="Direct link to Support for prefetching Virtual Filesystems" title="Direct link to Support for prefetching Virtual Filesystems">​</a></h2>
<p>Running workers with Fuse allows inputs for an action
to be downloaded on demand.
This significantly reduces the amount of data
that gets sent in order to run overspecified actions.
This however leads to poor performance for actions
which reads a lot of their inputs synchronously.</p>
<p>With the prefetcher most of these actions can be recognized
and data which is likely to be needed
can be downloaded ahead of time.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="support-for-sha256tree">Support for sha256tree<a href="#support-for-sha256tree" class="hash-link" aria-label="Direct link to Support for sha256tree" title="Direct link to Support for sha256tree">​</a></h2>
<p>Buildbarn has added support for
<a href="https://github.com/bazelbuild/remote-apis/pull/235" target="_blank" rel="noopener noreferrer">sha256tree</a>
which uses sha256 hashing over a tree structure similar to blake3.</p>
<p>This algorithm will allow large CAS objects to be chunked and decompositioned
with guaranteed data integrity while still using sha256 hardware instructions.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="completeness-checking-now-streams-rev2-tree-objects">Completeness checking now streams REv2 Tree objects<a href="#completeness-checking-now-streams-rev2-tree-objects" class="hash-link" aria-label="Direct link to Completeness checking now streams REv2 Tree objects" title="Direct link to Completeness checking now streams REv2 Tree objects">​</a></h2>
<p>This change introduces a small change to the configuration schema. If you previous had this:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">backend: { completenessChecking: ... },</span><br></span></code></pre></div></div>
<p>You will now need to write something along these lines:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">backend: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    completenessChecking: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        backend: ...,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        maximumTotalTreeSizeBytes: 64 * 1024 * 1024,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">},</span><br></span></code></pre></div></div>
<p>See also the
<a href="https://github.com/buildbarn/bb-storage/commit/1b84fa824dc60e77776ce50e05c549fdf20c089b" target="_blank" rel="noopener noreferrer">bb-storage commit 1b84fa8</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="postponed-healthy-service-status">Postponed healthy service status<a href="#postponed-healthy-service-status" class="hash-link" aria-label="Direct link to Postponed healthy service status" title="Direct link to Postponed healthy service status">​</a></h2>
<p>The healthy and serving status,
i.e. HTTP <code>/-/healthy</code> and
<a href="https://pkg.go.dev/google.golang.org/grpc/health/grpc_health_v1#HealthCheckResponse_ServingStatus" target="_blank" rel="noopener noreferrer">grpc_health_v1.HealthCheckResponse_SERVING</a>,
are now postponed until the whole service is up and running.
Before, the healthy status was potentially reported before starting to listen to the gRPC ports.
Kubernetes will now wait until the service is up before forwarding connections to it.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="server-keepalive-parameter-options">Server keepalive parameter options<a href="#server-keepalive-parameter-options" class="hash-link" aria-label="Direct link to Server keepalive parameter options" title="Direct link to Server keepalive parameter options">​</a></h2>
<p>The option <code>buildbarn.configuration.grpc.ServerConfiguration.keepalive_parameters</code> can be used for L4 load balancing,
to control when to ask clients to reconnect.
For default values, see
<a href="https://pkg.go.dev/google.golang.org/grpc@v1.49.0/keepalive#ServerParameters" target="_blank" rel="noopener noreferrer">keepalive.ServerParameters</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="graceful-termination-of-localblobaccess">Graceful termination of <code>LocalBlobAccess</code><a href="#graceful-termination-of-localblobaccess" class="hash-link" aria-label="Direct link to graceful-termination-of-localblobaccess" title="Direct link to graceful-termination-of-localblobaccess">​</a></h2>
<p>When <code>SIGTERM</code> or <code>SIGINT</code> is received, the <code>LocalBlobAccess</code> now synchronize data to disk before shutting down.
Deployments using persistent storage will no longer observe loss of data when restarting the <code>bb_storage</code> services.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="non-sector-aligned-writes-to-block-device">Non-sector Aligned Writes to Block Device<a href="#non-sector-aligned-writes-to-block-device" class="hash-link" aria-label="Direct link to Non-sector Aligned Writes to Block Device" title="Direct link to Non-sector Aligned Writes to Block Device">​</a></h2>
<p>Using sector aligned storage is wasteful for the action cache where the messages are typically very small.
Buildbarn can now fill all the gaps when writing, making storage more efficient.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="dag-shaped-blobaccess-configuration">DAG Shaped BlobAccess Configuration<a href="#dag-shaped-blobaccess-configuration" class="hash-link" aria-label="Direct link to DAG Shaped BlobAccess Configuration" title="Direct link to DAG Shaped BlobAccess Configuration">​</a></h2>
<p>Instead of a tree shaped BlobAccess configuration, the <code>with_labels</code> notation allows a directed acyclic graph.
See also the
<a href="https://github.com/buildbarn/bb-storage/commit/cc295adc0f05cd579d48a65325ce54b54331c6a6" target="_blank" rel="noopener noreferrer">bb-storage commit cc295ad</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="nfsv4-as-worker-filesystem">NFSv4 as worker filesystem<a href="#nfsv4-as-worker-filesystem" class="hash-link" aria-label="Direct link to NFSv4 as worker filesystem" title="Direct link to NFSv4 as worker filesystem">​</a></h2>
<p>The <code>bb_worker</code> can now supply the working directory for <code>bb_runner</code> using NFSv4.
Previously, FUSE and hard linking files from the worker cache were the only two options.
This addition was mainly done to overcome the poor FUSE support on macOS.</p>
<p>The NFSv4 server in <code>bb_worker</code> only supports macOS at the moment.
No effort has been spent to write custom mount logic for other systems yet.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="specify-forwardmetadata-with-a-jmespath">Specify <code>forwardMetadata</code> with a JMESPath<a href="#specify-forwardmetadata-with-a-jmespath" class="hash-link" aria-label="Direct link to specify-forwardmetadata-with-a-jmespath" title="Direct link to specify-forwardmetadata-with-a-jmespath">​</a></h2>
<p>Metadata forwarding is now more flexible, the JMESPath expressions can for example add authorization result data.
The format is described in
<a href="https://github.com/buildbarn/bb-storage/blob/0c2fcad5872b0fef47bb5bee8aba9518dc2fe465/pkg/proto/configuration/grpc/grpc.proto#L55-L93" target="_blank" rel="noopener noreferrer">grpc.proto</a>.</p>
<p>A common use case is to replace</p>
<div class="language-jsonnet codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-jsonnet codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    forwardMetadata: [&quot;build.bazel.remote.execution.v2.requestmetadata-bin&quot;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>with</p>
<div class="language-jsonnet codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-jsonnet codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    addMetadataJmespathExpression: &#x27;{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;build.bazel.remote.execution.v2.requestmetadata-bin&quot;:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            incomingGRPCMetadata.&quot;build.bazel.remote.execution.v2.requestmetadata-bin&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }&#x27;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="tracing-deprecate-the-jaeger-collector-span-exporter">Tracing: Deprecate the Jaeger collector span exporter<a href="#tracing-deprecate-the-jaeger-collector-span-exporter" class="hash-link" aria-label="Direct link to Tracing: Deprecate the Jaeger collector span exporter" title="Direct link to Tracing: Deprecate the Jaeger collector span exporter">​</a></h2>
<p>This option is deprecated, as Jaeger 1.35 and later provide native support for the OpenTelemetry protocol.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="bb-deployments-ubuntu-2204-example-runner-image"><code>bb-deployments</code> Ubuntu 22.04 Example Runner Image<a href="#bb-deployments-ubuntu-2204-example-runner-image" class="hash-link" aria-label="Direct link to bb-deployments-ubuntu-2204-example-runner-image" title="Direct link to bb-deployments-ubuntu-2204-example-runner-image">​</a></h2>
<p>The <a href="https://github.com/bazelbuild/bazel-toolchains/blob/4.0.0/rules/rbe_repo.bzl#L896" target="_blank" rel="noopener noreferrer">rbe_autoconfig</a>
in <a href="https://github.com/bazelbuild/bazel-toolchains" target="_blank" rel="noopener noreferrer">bazel-toolchains</a>
has been deprecated. In bb-deployments it has been replaced by the
<a href="https://github.com/nektos/act/blob/master/IMAGES.md" target="_blank" rel="noopener noreferrer">Act</a> image
<a href="https://github.com/catthehacker/docker_images" target="_blank" rel="noopener noreferrer">ghcr.io/catthehacker/ubuntu<!-- -->:act-22<!-- -->.04</a>,
distributed by <a href="https://github.com/catthehacker/docker_images" target="_blank" rel="noopener noreferrer">catthehacker</a>,
used for running GitHub Actions locally under Ubuntu 22.04.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="bb-deployments-integration-tests"><code>bb-deployments</code> Integration Tests<a href="#bb-deployments-integration-tests" class="hash-link" aria-label="Direct link to bb-deployments-integration-tests" title="Direct link to bb-deployments-integration-tests">​</a></h2>
<p>The <a href="https://github.com/buildbarn/bb-deployments/tree/ce123473f27290648d1e56f7072468eb6b67fefb/bare" target="_blank" rel="noopener noreferrer">bare deployment</a> and
<a href="https://github.com/buildbarn/bb-deployments/tree/ce123473f27290648d1e56f7072468eb6b67fefb/docker-compose" target="_blank" rel="noopener noreferrer">Docker Compose deployment</a>
have now got <a href="https://github.com/buildbarn/bb-deployments/tree/ce123473f27290648d1e56f7072468eb6b67fefb/tools" target="_blank" rel="noopener noreferrer">tests scripts</a>
that builds and tests <code>@abseil-hello//:hello_test</code> remotely, shuts down and then checks for 100% cache hit after restart.
Another CI test is checking for minimal differences between the Docker Compose deployment and
the <a href="https://github.com/buildbarn/bb-deployments/tree/ce123473f27290648d1e56f7072468eb6b67fefb/kubernetes" target="_blank" rel="noopener noreferrer">Kubernetes deployment</a>.</p>
<p>If there are any other changes you feel deserve a mention
feel free to submit a pull request at github using the link below.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/blog/tags/release/">release</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/blog/tags/buildbarn/">buildbarn</a></li></ul></div></footer></article><article class="margin-bottom--xl"><header><h2 class="title_f1Hy"><a href="/blog/bb-deploy-updates-2022-04/">Updates to Buildbarn deployment repo as of April 2022</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2022-05-04T00:00:00.000Z">May 4, 2022</time> · <!-- -->2 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><img class="avatar__photo authorImage_XqGP" src="/img/benjamin-avatar.png" alt="Benjamin Ingberg"><div class="avatar__intro authorDetails_lV9A"><div class="avatar__name"><span class="authorName_yefp">Benjamin Ingberg</span></div><div class="authorSocials_rSDt"></div></div></div></div></div></header><div class="markdown"><p>The <a href="https://github.com/buildbarn/bb-deployments" target="_blank" rel="noopener noreferrer">sample configuration project for Buildbarn</a> was recently updated after a long hiatus. As an aid for people to understand which changes have been done see the following high level summary.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="april-2022-updates">April 2022 Updates<a href="#april-2022-updates" class="hash-link" aria-label="Direct link to April 2022 Updates" title="Direct link to April 2022 Updates">​</a></h2>
<p>This includes updates to Buildbarn since December 2020.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="authorizer-overhaul">Authorizer Overhaul<a href="#authorizer-overhaul" class="hash-link" aria-label="Direct link to Authorizer Overhaul" title="Direct link to Authorizer Overhaul">​</a></h3>
<p>Authorizers have been rehauled to be more flexible it is now part of each individual cache and execution configuration.</p>
<p>Using a JWT authorization bearer token has been added as an authorization method.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="hierarchical-blob-access">Hierarchical Blob Access<a href="#hierarchical-blob-access" class="hash-link" aria-label="Direct link to Hierarchical Blob Access" title="Direct link to Hierarchical Blob Access">​</a></h3>
<p>Using hierarchical blob access allows blobs in instance name <code>foo/bar</code> to be accessed from instance <code>foo/bar/baz</code> but not instance <code>foo</code> or <code>foo/qux</code>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="action-result-expiration">Action Result Expiration<a href="#action-result-expiration" class="hash-link" aria-label="Direct link to Action Result Expiration" title="Direct link to Action Result Expiration">​</a></h3>
<p>An expiry can be added to action result which lets the action cache purge the result of an exection that was performed too far in the past. This can be used to ensure that all targets are rebuilt periodically even if they are accessed frequently enough to not normally be purged from the cache.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="read-only-cache-replicas">Read Only Cache Replicas<a href="#read-only-cache-replicas" class="hash-link" aria-label="Direct link to Read Only Cache Replicas" title="Direct link to Read Only Cache Replicas">​</a></h3>
<p>Cache read traffic can now be sent to a read-only replica which is periodically probed for availability.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="concurrency-limiting-blob-replication">Concurrency Limiting Blob Replication<a href="#concurrency-limiting-blob-replication" class="hash-link" aria-label="Direct link to Concurrency Limiting Blob Replication" title="Direct link to Concurrency Limiting Blob Replication">​</a></h3>
<p>Limit the number of concurrent replications to prevent network starvation</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="run-commands-as-another-user">Run Commands as Another User<a href="#run-commands-as-another-user" class="hash-link" aria-label="Direct link to Run Commands as Another User" title="Direct link to Run Commands as Another User">​</a></h3>
<p>Allows the commands to be run as a different user, on most platforms this means the bb-runner instance must run as root.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="size-class-analysis">Size Class Analysis<a href="#size-class-analysis" class="hash-link" aria-label="Direct link to Size Class Analysis" title="Direct link to Size Class Analysis">​</a></h3>
<p>Allows executors of different size classes to be used, the scheduler will attempt to utilize executors efficiently but there is an inherent tradeof between throughput and latency. Once configured the scheduler will automatically attempt to keep track of which actions are best run on which executors.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="execution-routing-policy">Execution Routing Policy<a href="#execution-routing-policy" class="hash-link" aria-label="Direct link to Execution Routing Policy" title="Direct link to Execution Routing Policy">​</a></h3>
<p>The scheduler accepts an execution routing policy configuration that allows it to determine how to defer builds to different executors.</p>
<p>If you see any other changes you feel should get a mention feel free to submit a pull request at github using the link below.</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/blog/tags/release/">release</a></li><li class="tag_QGVx"><a rel="tag" class="tag_zVej tagRegular_sFm0" href="/blog/tags/buildbarn/">buildbarn</a></li></ul></div></footer></article><nav class="pagination-nav" aria-label="Blog list page navigation"></nav></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/intro/">Introduction</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/theory/components-of-a-build/">Theory</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">About Us</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/services/">Services</a></li><li class="footer__item"><a class="footer__link-item" href="/contact/">Contact</a></li><li class="footer__item"><a href="https://forms.gle/wchwDu6roWg6A7U29" target="_blank" rel="noopener noreferrer" class="footer__link-item">Sign up<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/master-thesis/">Master Thesis</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Buildbarn Environments</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/services/managed-buildbarn/">Managed Buildbarn</a></li><li class="footer__item"><a class="footer__link-item" href="/services/supported-build-environment/">Supported Build Environment</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog/">Blog</a></li><li class="footer__item"><a class="footer__link-item" href="/bug-bounty/">Bug bounty</a></li><li class="footer__item"><a class="footer__link-item" href="/privacy-policy/">Privacy Policy</a></li><li class="footer__item"><a href="https://github.com/meroton" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Meroton AB</div></div></div></footer></div>
</body>
</html>